<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <template id="script_code">
        <script type="text/javascript">
            <t t-set="live_session_key"
               t-value="request.env['ir.config_parameter'].sudo().get_param('live_session.access_key')"/>
            !function(w, d, t, u) {
            if (w.__ls) return; var f = w.__ls = function() { f.push ? f.push.apply(f, arguments) :
            f.store.push(arguments)};
            if (!w.__ls) w.__ls = f; f.store = []; f.v = '1.0';

            var ls = d.createElement(t); ls.async = true; ls.src = u;
            var s = d.getElementsByTagName(t)[0]; s.parentNode.insertBefore(ls, s);
            }(window, document, 'script', ('https:' == window.location.protocol ? 'https://' : 'http://') +
            'cdn.livesession.io/track.js');

            __ls('init', '<t t-esc="live_session_key"/>', { keystrokes: false });
            __ls('newPageView');
            __ls('identify', {name: '<t t-esc="env.user.name"/>', email: '<t t-esc="env.user.email"/>'});
        </script>
    </template>
    <template id="frontend_assets" name="live session assets front" inherit_id="web.frontend_layout">
        <xpath expr="//head/script[1]" position="after">
            <t t-set="is_using_live_session"
               t-value="request.env['ir.config_parameter'].sudo().get_param('live_session.is_enabled')"/>
            <t t-set="live_session_type"
               t-value="request.env['ir.config_parameter'].sudo().get_param('live_session.type')"/>
            <t t-call="live_session.script_code"
               t-if="is_using_live_session and (live_session_type=='Frontend')"/>
        </xpath>
    </template>
    <template id="assets" name="live session assets both" inherit_id="web.layout">
        <xpath expr="//head/script[1]" position="after">
            <t t-set="is_using_live_session"
               t-value="request.env['ir.config_parameter'].sudo().get_param('live_session.is_enabled')"/>
            <t t-set="live_session_type"
               t-value="request.env['ir.config_parameter'].sudo().get_param('live_session.type')"/>
            <t t-call="live_session.script_code"
               t-if="is_using_live_session and (live_session_type=='Both')"/>
        </xpath>
    </template>
</odoo>
