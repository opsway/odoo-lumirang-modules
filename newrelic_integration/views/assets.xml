<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <template id="assets" name="newrelic assets" inherit_id="web.layout">
        <xpath expr="//head/script[1]" position="after">
            <t t-set="has_newrelic"
               t-value="request.env['res.config.settings'].has_newrelic()"/>
            <t t-set="is_using_newrelic"
               t-value="request.env['ir.config_parameter'].sudo().get_param('newrelic.is_enabled')"/>
            <script type="text/javascript" t-if="has_newrelic and is_using_newrelic">
                if(window.newrelic){
                newrelic.setCustomAttribute('user_name', '<t t-esc="env.user.name"/>');
                newrelic.setCustomAttribute('user_email', '<t t-esc="env.user.email"/>');
                }
            </script>
        </xpath>
    </template>
    <template id="crash_manager_fe" name="crash manager fe" inherit_id="web.assets_frontend">
        <xpath expr="//script[@src='/web/static/src/js/public/public_crash_manager.js']" position="after">
            <t t-set="has_newrelic"
               t-value="request.env['res.config.settings'].has_newrelic()"/>
            <t t-set="is_using_newrelic"
               t-value="request.env['ir.config_parameter'].sudo().get_param('newrelic.is_enabled')"/>
            <script type="text/javascript" src="/newrelic_integration/static/src/js/public_crash_manager.js"
                    t-if="has_newrelic and is_using_newrelic"/>
        </xpath>
    </template>
    <template id="crash_manager_be" name="crash manager be" inherit_id="web.assets_common">
        <xpath expr="//script[@src='/web/static/src/js/services/crash_manager.js']" position="after">
            <t t-set="has_newrelic"
               t-value="request.env['res.config.settings'].has_newrelic()"/>
            <t t-set="is_using_newrelic"
               t-value="request.env['ir.config_parameter'].sudo().get_param('newrelic.is_enabled')"/>
            <script type="text/javascript" src="/newrelic_integration/static/src/js/crash_manager.js"
                    t-if="has_newrelic and is_using_newrelic"/>
        </xpath>
    </template>
    <template id="crash_manager_service" name="crash manager service" inherit_id="web.assets_backend">
        <xpath expr="//script[@src='/web/static/src/js/services/crash_manager_service.js']" position="after">
            <t t-set="has_newrelic"
               t-value="request.env['res.config.settings'].has_newrelic()"/>
            <t t-set="is_using_newrelic"
               t-value="request.env['ir.config_parameter'].sudo().get_param('newrelic.is_enabled')"/>
            <script type="text/javascript" src="/newrelic_integration/static/src/js/crash_manager_service.js"
                    t-if="has_newrelic and is_using_newrelic"/>
        </xpath>
    </template>
</odoo>
